<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Suivi des HNO</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root { --free-primary: #E80029; --free-light-bg:#F5F5F5; --free-dark:#333333; }
        body{font-family:Roboto,Arial,sans-serif;margin:0;background:var(--free-light-bg);color:var(--free-dark)}
        header{background:var(--free-primary);color:#fff;padding:14px 0;box-shadow:0 4px 10px rgba(0,0,0,0.2);position:sticky;top:0;z-index:1000}
        .header-content{width:90%;max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
        .free-logo-small{height:28px;filter:grayscale(1) brightness(100);vertical-align:middle}
        .nav-toggle{display:inline-block;background:transparent;border:1px solid rgba(255,255,255,0.15);color:#fff;padding:8px 10px;border-radius:6px;cursor:pointer;font-size:18px}
        .nav-toggle i{transition:transform 220ms ease,color 220ms ease;font-size:18px;display:inline-block;line-height:1}
        .nav-toggle.open i{transform:rotate(90deg) scale(1.05);color:#fff}
        .title{font-size:1.5em;font-weight:900;margin:0;padding-left:20px;border-left:1px solid rgba(255,255,255,0.5)}
        .header-link{color:#fff;text-decoration:none;font-weight:700;border:1px solid rgba(255,255,255,0.25);padding:8px 12px;border-radius:6px;display:none}
        .header-link.show{display:inline-block}
        .container{width:90%;max-width:1100px;margin:20px auto}
        .card{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
        .form-group{margin-bottom:12px}
        label{display:block;margin-bottom:6px;font-weight:600}
        input,textarea,select{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px}
        .row{display:flex;gap:12px;align-items:flex-start}
        .col{flex:1}
        .btn{background:var(--free-primary);color:#fff;padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
        .btn.secondary{background:#eee;color:#333}
        table{width:100%;border-collapse:collapse;margin-top:12px}
        th,td{padding:8px;border-bottom:1px solid #f0f0f0}
        th{background:#fafafa;text-align:left}
        .actions button{background:none;border:none;color:#c82333;cursor:pointer}
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div style="display:flex;align-items:center;gap:12px;">
                <button class="nav-toggle" aria-label="Afficher le menu" aria-expanded="false" onclick="toggleNavHNO()"><i class="fas fa-bars" aria-hidden="true"></i></button>
                <img class="free-logo-small" src="https://raw.githubusercontent.com/rfontaine974/FREE-suivi-activite/main/Free_logo.svg.png" alt="Logo Free">
                <h1 class="title">Suivi des HNO</h1>
            </div>
            <a class="header-link" href="index.html">Suivi OT</a>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <h2>Ajouter un Ticket HNO</h2>
            <form id="hnoFormMain" onsubmit="handleHNOFormMain(event)">
                <div class="form-group">
                    <label for="hnoDesignationMain">D√©signation de la T√¢che <span style="color:var(--free-primary);">*</span></label>
                    <input id="hnoDesignationMain" type="text" placeholder="Ex: Maintenance antenne" required>
                </div>
                <div class="row">
                    <div class="col form-group">
                        <label for="hnoSiteMain">Code Site <span style="color:var(--free-primary);">*</span></label>
                        <input id="hnoSiteMain" type="text" placeholder="Ex: S1-IDF" required>
                    </div>
                    <div class="col form-group">
                        <label for="hnoDateLimiteMain">Date Limite Souhait√©e</label>
                        <input id="hnoDateLimiteMain" type="date">
                    </div>
                </div>
                <div class="form-group">
                    <label for="hnoDescMain">Description de l'Intervention</label>
                    <textarea id="hnoDescMain" rows="3" placeholder="D√©tails de l'intervention..."></textarea>
                </div>
                <div style="display:flex;gap:8px">
                    <button class="btn" type="submit">Ajouter</button>
                    <button type="button" class="btn secondary" onclick="resetHNOFormMain()">R√©initialiser</button>
                    <button type="button" class="btn secondary" onclick="exportHNOCsvMain()">Exporter CSV</button>
                </div>
            </form>
        </div>

        <div class="card" style="margin-top:16px">
            <h3>Liste des Tickets HNO</h3>
            <div style="overflow-x:auto">
                <table id="hnoTableMain"><thead><tr><th>D√©signation</th><th>Code Site</th><th>Date Limite</th><th>Description</th><th>Actions</th></tr></thead><tbody id="hnoTableBodyMain"><tr><td colspan="5" style="text-align:center;color:#666;padding:12px">Aucun enregistrement.</td></tr></tbody></table>
            </div>
        </div>
    </div>

    <script>
        function toggleNavHNO(){
            const toggle = document.querySelector('.nav-toggle');
            if(!toggle) return;
            const icon = toggle.querySelector('i');
            const isOpen = toggle.classList.toggle('open');
            toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            const headerLink = document.querySelector('.header-link');
            if(headerLink){ headerLink.classList.toggle('show', isOpen); }
            if(icon){
                if(isOpen){ icon.classList.remove('fa-bars'); icon.classList.add('fa-times'); }
                else { icon.classList.remove('fa-times'); icon.classList.add('fa-bars'); }
            }
        }
        const HNO_KEY = 'suivi_hno_list_v1';
        function getList(){try{return JSON.parse(localStorage.getItem(HNO_KEY)||'[]')}catch(e){return[]}}
        function saveList(l){localStorage.setItem(HNO_KEY,JSON.stringify(l))}
        function handleHNOFormMain(e){e.preventDefault();const designation=document.getElementById('hnoDesignationMain').value.trim();const site=document.getElementById('hnoSiteMain').value.trim();const dateLimite=document.getElementById('hnoDateLimiteMain').value;const desc=document.getElementById('hnoDescMain').value.trim();if(!designation||!site){alert('D√©signation et Code Site requis');return}const item={id:Date.now(),designation,site,dateLimite:dateLimite||'',desc};const l=getList();l.unshift(item);saveList(l);render();resetHNOFormMain()}
        function resetHNOFormMain(){document.getElementById('hnoFormMain').reset();document.getElementById('hnoDateLimiteMain').value='';document.getElementById('hnoDesignationMain').value='';document.getElementById('hnoSiteMain').value='';document.getElementById('hnoDescMain').value=''}
        function render(){const b=document.getElementById('hnoTableBodyMain');const l=getList();b.innerHTML='';if(!l.length){b.innerHTML='<tr><td colspan="5" style="text-align:center;color:#666;padding:12px">Aucun enregistrement.</td></tr>';return}l.forEach(it=>{const tr=document.createElement('tr');const dlFormatted=it.dateLimite?new Date(it.dateLimite).toLocaleDateString('fr-FR'):'N/A';tr.innerHTML=`<td>${escapeHtml(it.designation||'')}</td><td>${escapeHtml(it.site)}</td><td>${dlFormatted}</td><td>${escapeHtml(it.desc)}</td><td class="actions"><button title="Supprimer" onclick="deleteItem(${it.id})">üóëÔ∏è</button></td>`;b.appendChild(tr)})}
        function deleteItem(id){if(!confirm('Supprimer ?'))return;saveList(getList().filter(x=>x.id!==id));render()}
        function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[ch])}
        function exportHNOCsvMain(){const l=getList();if(!l.length){alert('Aucun HNO √† exporter');return}const headers=['Designation','Code_Site','Date_Limite','Description'];const rows=l.map(i=>[i.designation||'',i.site,i.dateLimite||'',i.desc||'']);const csv=[headers,...rows].map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""') }"`).join(',')).join('\n');const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`hno_export_${new Date().toISOString().slice(0,10)}.csv`;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url)}
        document.addEventListener('DOMContentLoaded',render);
    </script>
</body>
</html>
